var CanvasApp=function(){var a={};a.params={$body:function(){return $("body")},apiUrl:"/umbraco/canvas/api",pageId:function(){return $("input[name=canvas-pageId]").val()},version:function(){return $("input[name=canvas-version]").val()},getIframeContent:function(){var a=document.getElementById("canvas-iframe");return a.contentDocument},getIframeWindow:function(){var a=document.getElementById("canvas-iframe");return a.contentWindow},controls:["Grid","Section","Macro","RichText","Media","Text","Heading","Button"],controlIndex:0,tinyMceConfig:{selector:"textarea.canvas-editable",mode:"exact",skin:"umbraco",menubar:!1,statusbar:!1,relative_urls:!1,force_p_newlines:"false",remove_linebreaks:!1,force_br_newlines:!0,apply_source_formatting:!0,remove_trailing_nbsp:!1,image_dimensions:!1,init_instance_callback:function(e){a.pickers.mediaPicker.canvasResizeImage(e)},toolbar:"codemirror bold italic alignleft aligncenter alignright bullist umlist outdent indent link image umbmediapicker umbembeddialog umbmacro",plugins:["autolink lists link print anchor table","code fullscreen contextmenu paste codemirror"],codemirror:{indentOnInit:!0,path:"/Umbraco/lib/codemirror",config:{mode:"htmlmixed",lineNumbers:!0}}},tinyMceConfigAdv:{selector:"textarea#canvas-advanced-content",mode:"exact",skin:"umbraco",menubar:!1,statusbar:!1,remove_trailing_nbsp:!0,image_dimensions:!1,init_instance_callback:function(e){a.pickers.mediaPicker.canvasResizeImage(e)},toolbar:"codemirror undo redo bold italic formatselect alignleft aligncenter alignright bullist umlist outdent indent link table umbmediapicker umbcontentpicker umbembeddialog umbmacro fullscreen anchor paste searchreplace",plugins:["autolink lists link print anchor table","code fullscreen contextmenu paste codemirror"],codemirror:{indentOnInit:!0,path:"/Umbraco/lib/codemirror",config:{mode:"htmlmixed",lineNumbers:!0,indentUnit:4,tabSize:4}}}},a.bar={init:function(){var a=this;a.wrapper(),a.render(),a.screenOptions(),a.controlMenu()},wrapper:function(){var e=this;$("body").wrapInner("<div class='canvas-pageWrapper'></div>"),$(".canvas-pageWrapper").hide(),$(".canvas-pageWrapper").find("*:not(.canvas-settings, .canvas-settings *)").remove(),a.controlMenu.init();var n=document.createElement("iframe");n.src="/umbraco/dialogs/Preview.aspx?id="+a.params.pageId(),n.id="canvas-iframe",n.width="100%",n.onload=function(){a.areas.init(n.contentDocument),a.control.init($(n.contentDocument)),a.helpers.loader.stop()},document.body.appendChild(n),$("body").addClass("canvas-body"),e.resizeIframe(),$(window).resize(function(){e.resizeIframe()})},resizeIframe:function(){var a=$(window).height();$("#canvas-iframe").css("height",a-60)},render:function(){var a=$('<div><div class="canvas-bar"><div class="canvas-left"></div><div class="canvas-right"></div></div></div>');a.find(".canvas-bar .canvas-left").append('<div class="canvas-item canvas-item-logo canvas-border-right"><img src="/app_plugins/canvas/content/svg/vettvangur.svg" style=width:40px; height:20px;" alt="Vettvangur"/></div>'),a.find(".canvas-bar .canvas-left").append('<a href="#" class="canvas-item canvas-border-right canvas-item-menu canvasicon-menu"></a>'),a.find(".canvas-bar .canvas-left").append('<a href="#" class="canvas-item canvas-border-right canvas-item-templates canvasicon-papers"></a>'),a.find(".canvas-bar .canvas-right").append('<a href="#" class="canvas-item canvas-border-right canvas-item-settings canvasicon-cog"></a>'),a.find(".canvas-bar .canvas-right").append('<div class="canvas-options canvas-item canvas-border-right canvas-item-screens canvasicon-desktop"><ul class="canvas-screen-options"><li class="canvasicon-desktop canvas-selected"></li><li class="canvasicon-tablet-landscape"></li><li class="canvasicon-tablet"></li><li class="canvasicon-smartphone-landscape"></li><li class="canvasicon-smartphone"></li></ul></div>'),$("body").append(a.html())},screenOptions:function(){$("body").on("click",".canvas-options",function(a){a.preventDefault(),$(this).toggleClass("canvas-open")}),$("body").on("click",".canvas-item-screens li",function(a){a.preventDefault();var e=$(this).attr("class");$(".canvas-item-screens li").removeClass("canvas-selected"),$(this).addClass("canvas-selected");var n=$(this).closest(".canvas-options");n.removeClass("canvas-open canvasicon-desktop canvasicon-laptop canvasicon-tablet canvasicon-tablet-landscape canvasicon-smartphone canvasicon-smartphone-landscape"),n.addClass(e);var t="100%";"canvasicon-desktop"==e&&(t="100%"),"canvasicon-tablet-landscape"==e&&(t="1024px"),"canvasicon-tablet"==e&&(t="768px"),"canvasicon-smartphone-landscape"==e&&(t="480px"),"canvasicon-smartphone"==e&&(t="320px"),$("#canvas-iframe").attr("style","width:"+t)})},controlMenu:function(){$("body").on("click",".canvas-item-menu",function(a){a.preventDefault(),$(".canvas-menu").toggleClass("canvas-open")})}},a.controlMenu={init:function(){var a=this;$(".canvas-menu").length<=0&&(a.render(),a.makeControlsDraggable(),a.resizeList(),$(window).on("resize",function(){a.resizeList()}))},render:function(){var e=$('<div><div class="canvas-menu"><ul class="canvas-controls" id="canvas-controls"></ul></div></div>');$(a.params.controls).each(function(){var a=this;e.find(".canvas-controls").append('<li class="canvas-control" data-control="'+a+'" data-controlType="'+a+'">'+a+"</li>")}),$("body").append(e.html())},makeControlsDraggable:function(){var e=document.getElementById("canvas-controls");Sortable.create(e,{group:{name:"controls",put:!1,pull:"clone"},delay:0,sort:!1,ghostClass:"canvas-sortable-placeholder",chosenClass:"canvas-sortable-chosen",draggable:".canvas-control",animation:0,setData:function(a,e){a.setData("Text",e.textContent)},onStart:function(e){$(".canvas-menu,.canvas-window,canvas-overlay").removeClass("canvas-open"),$(a.params.getIframeContent()).find("body").addClass("canvas-ui-dragging")},onEnd:function(e){$(".canvas-menu").addClass("canvas-open"),$(a.params.getIframeContent()).find("body").removeClass("canvas-ui-dragging");var n=$(e.item);n.parent().hasClass("canvas-controls")||n.remove()}})},resizeList:function(){a.helpers.resizeWindow($(".canvas-menu"))}},a.areas={init:function(a){this.MakeSortable(a)},MakeSortable:function(e){var n=this,t=$(e).find(".canvas-area");$(t).each(function(){var e=$(this);Sortable.create(e[0],{group:{name:"controls",put:!0,pull:!0},sort:!0,delay:0,handle:".canvas-action-move",animation:0,draggable:".canvas-control",ghostClass:"canvas-sortable-control",chosenClass:"canvas-sortable-chosen",scroll:!0,scrollSensitivity:5,scrollSpeed:10,setData:function(a,e){a.setData("Text",e.textContent)},onStart:function(e){a.params.$body().find(".canvas-menu,.canvas-window,canvas-overlay").removeClass("canvas-open"),a.params.$body().addClass("canvas-ui-dragging")},onEnd:function(e){a.params.$body().removeClass("canvas-ui-dragging")},onAdd:function(e){var t=$(e.item),s=$(e.from),i=$(e.to),c=e.newIndex;if(a.params.controlIndex=c,s.hasClass("canvas-controls")){var o=t.text();n.addControl(i,o,c)}else s.find("> .canvas-control").length<=0&&s.addClass("canvas-area-empty"),n.sortControl(s.data("area"),i,t.data("controlid"));i.removeClass("canvas-area-empty")},onUpdate:function(e){var t=$(e.item),s=$(e.from),i=$(e.to),c=e.newIndex;a.params.controlIndex=c,n.sortControl(s.data("area"),i,t.data("controlid"))}})})},addControl:function(e,n,t){var s=this;$.ajax({type:"POST",url:a.params.apiUrl+"/AddControl?areaAlias="+e.data("area")+"&controlType="+n+"&pageId="+a.params.pageId(),success:function(n){a.helpers.loader.stop();var t=s.renderControlWrapper(n.controlType,n.controlId),i=a.params.controlIndex;if(0==i)e.prepend(t);else{var c=e.find("> .canvas-control:eq("+(i-1)+")");c.length>0?c.after(t):e.append(t)}e.find(" > .canvas-control").length>0&&s.sortControl(e.data("area"),e,n.controlId),a.areas.MakeSortable($(a.params.getIframeContent()).find("body")),a.control.editControl(n.controlId)}})},sortControl:function(e,n,t){a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/SortControl?areaFromAlias="+e+"&areaToAlias="+n.attr("data-area")+"&pageId="+a.params.pageId()+"&controlId="+t+"&position="+a.params.controlIndex,success:function(e){a.helpers.loader.stop(),a.helpers.RenderPublish()},error:function(a,e,n){}})},renderControlWrapper:function(e,n){var t='<div class="canvas-control-actions"><a href="#" class="canvas-action-edit">Edit</a><a href="#" class="canvas-action-delete">Delete</a><a href="#" class="canvas-action-move">Move</a></div>',s=$("<div class='canvas-control' data-controlId='"+n+"' data-controlType='"+e+"'><div class='canvas-control-content'></div><span class='canvas-border canvas-border-top'></span><span class='canvas-border canvas-border-right'></span><span class='canvas-border canvas-border-bottom'></span><span class='canvas-border canvas-border-left'></span></div>");return"Grid"==e?(content='<div class="row"><div class="column medium-6"><div class="canvas-area canvas-area-empty" data-area="grid-6-'+n+'-0" data-pageid="'+a.params.pageId()+'" data-position="0"></div></div><div class="column medium-6"><div class="canvas-area canvas-area-empty" data-area="grid-6-'+n+'-1" data-pageid="'+a.params.pageId()+'" data-position="1"></div></div></div>',s.prepend(t).find(".canvas-control-content").prepend(content)):"Media"==e?s.prepend(t).find(".canvas-control-content").prepend('<div class="canvas-media-placeholder">No media set</div>'):"Macro"==e?s.prepend(t).find(".canvas-control-content").prepend('<div class="canvas-macro-placeholder">No macro selected</div>'):"Section"==e?(content='<section class="row column"><div class="container"><div class="canvas-area" data-area="section-'+n+'"></div></div></section>',s.prepend(t).find(".canvas-control-content").prepend(content)):"Heading"==e?s.prepend(t).find(".canvas-control-content").prepend('<div class="canvas-heading-placeholder">No title set</div>'):"Button"==e?s.prepend(t).find(".canvas-control-content").prepend('<div class="canvas-button-placeholder">No title set</div>'):s.prepend(t).find(".canvas-control-content").prepend('<div class="canvas-richtext-placeholder">Write content here...</a>'),a.control.deleteControl(s.find(".canvas-action-delete")),a.control.initEditControl(s.find(".canvas-action-edit")),s}},a.control={init:function(a){this.deleteControl(a.find(".canvas-action-delete")),this.initEditControl(a.find(".canvas-action-edit"))},deleteControl:function(e){e.on("click",function(e){e.preventDefault();var n=$(this).closest(".canvas-control"),t=$(this).closest(".canvas-area"),s=t.attr("data-area"),i=n.attr("data-controlId"),c=n.attr("data-controlType"),o=t.attr("data-position");""!=o&&void 0!==o&&(s=s+"-"+o),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/DeleteControl?areaAlias="+s+"&controlId="+i+"&pageId="+a.params.pageId()+"&controlType="+c,success:function(e){n.remove(),a.helpers.loader.stop();var s=t.find("> .canvas-control");$(s).each(function(a){$(this).attr("data-position",a),a++}),t.find(" > .canvas-control").length<=0&&t.addClass("canvas-area-empty"),a.helpers.RenderPublish()},error:function(a,e,n){}})})},initEditControl:function(a){var e=this;a.on("click",function(a){a.preventDefault();var n=$(this).closest(".canvas-control").attr("data-controlId");e.editControl(n)})},editControl:function(e){var n=this;$window=$(".canvas-window"),a.helpers.loader.start(),$.ajax({type:"GET",url:a.params.apiUrl+"/EditControl?controlId="+e+"&pageId="+a.params.pageId(),success:function(t){a.helpers.loader.stop(),$window.html("");var s=$('<div class="canvas-container"><a href="#" class="canvas-window-close">Close window</a><form method="post" action="'+a.params.apiUrl+'/EditControl"><input type="hidden" name="controlId" value="'+e+'" /><input type="hidden" name="pageId" value="'+a.params.pageId()+'" /><input type="hidden" name="controlType" value="'+t.type+'" /></form></div>');$(t.properties).each(function(a,e){var i=n.propertiesBuilder.renderProperty(e.Key,t.type,e.Value,t);s.find("form").append(i)}),s.find("form").append('<button type="submit" data-type="save">Save</button>'),$window.append(s).addClass("canvas-open");var i=tinymce.get("canvas-editor-simple");null!=i&&i.remove(),tinymce.init(a.params.tinyMceConfig),n.postEdit(s.find("form")),a.helpers.resizeWindow($(".canvas-window")),$(window).on("resize",function(){a.helpers.resizeWindow($(".canvas-window"))})}})},postEdit:function(e){e.on("submit",function(n){n.preventDefault();var t=e.find("button[type=submit]");if(t.attr("disabled","disabled"),a.helpers.loader.start(),e.find(".canvas-macro-properties-wrapper").each(function(e,n){var t=$(this).parent(),s=t.find("input[name=Macro]");$(this).find(".canvas-control-group").each(function(e,n){var t=$(this).find("input,textarea,select"),i=a.helpers.escapeHtml.run(t.val()),c=t.attr("name"),o=s.val();if("select-macro"!=c){t.is(":checkbox")&&(i=t.is(":checked")?"1":"0");var r=new RegExp(c+"=(\"[^\"]*\"|'[^']*'|w+)","g");o=o.indexOf(c+"=")>-1?o.replace(r,c+"='"+i+"'"):o.replace("/>",c+"='"+i+"' />"),s.val(o)}})}),e.find(".canvas-control-group-columns").length>0){var s="";e.find(".canvas-control-group-columns").each(function(a,e){var n=$(this).find(".canvas-gridColumns-col").val(),t=$(this).find(".canvas-gridColumns-screen").val(),i=$(this).find(".canvas-gridColumns-config").val();s+=n+":"+t+":"+i+";"}),e.find("input[name=Columns]").val(s)}$.ajax({type:"POST",url:e.attr("action"),data:e.serialize(),success:function(e){a.params.getIframeWindow().location.reload(),t.removeAttr("disabled")},error:function(e,n,s){a.helpers.loader.stop(),t.removeAttr("disabled")}})})},propertiesBuilder:{renderProperty:function(a,e,n,t){var s=this,c="";switch(a){case"Title":("RichText"==e||"Media"==e||"Text"==e||"Heading"==e||"Button"==e)&&(c=s.build("Umbraco.Textbox",a,a,n));break;case"Description":"Media"==e&&(c=s.build("Umbraco.TextboxMultiple",a,a,n)),"Button"==e&&(c=s.build("Umbraco.Textbox",a,"Url",n));break;case"Content":"RichText"==e&&(c=s.build("Umbraco.TinyMCEv3",a,a,n)),"Text"==e&&(c=s.build("Umbraco.TextboxMultiple",a,a,n));break;case"Template":("Media"==e||"RichText"==e||"Text"==e||"Section"==e||"Grid"==e||"Heading"==e||"Button"==e||"Macro"==e)&&(c=$('<div class="canvas-control-group canvas-clearfix"><label for="'+a+'">'+a+' <a href="#" class="canvas-template-new" style="float:right; margin-left:10px;">New</a> <a href="#" class="canvas-template-edit" style="float:right; margin-left:10px;">Edit</a></label><select name="'+a+'" id="'+a+'"><option value="">Select template</option></select></div>'),$(t.templates).each(function(a){var e="";n==this.path&&(e='selected="selected"'),c.find("select").append('<option value="'+this.path+'" '+e+">"+this.name+"</option>")}));break;case"Item":("Media"==e||"Section"==e)&&(c=s.build("Umbraco.MediaPicker",a,a,n));break;case"Macro":if("Macro"==e){c=$('<div class="canvas-control-group"><label for="select-'+a+'">'+a+'<a href="#" class="canvas-macro-editTemplate" style="float:right;">Edit</a></label><select name="select-'+a+'" id="select-'+a+'" class="canvas-macro-select"><option value="">Select macro</option></select><input type="hidden" name="'+a+'" value="'+n.replace(/"/g,"'")+'" /></div>');var o=new RegExp("macroAlias=(\"[^<>\"]*\"|'[^<>']*'|w+)","g"),r=o.exec(n),l="";""!=n&&(l=r[1].replace(/"/g,"").replace(/'/g,"")),c.find(".canvas-macro-select").on("change",function(a){a.preventDefault();var e=$(this),n=e.val();$(".canvas-properties-wrapper").html(""),$(".canvas-window input[name=Macro]").val(""),""!=n&&s.renderMacroProperties(n,e,"",e.find("option:selected").attr("data-macroAlias"))}),$(t.macros).each(function(a){var e="";l==this.macroAlias&&(e='selected="selected"',s.renderMacroProperties(this.id,c.find("select"),n,this.macroAlias)),c.find("select").append('<option value="'+this.id+'" data-macroAlias="'+this.macroAlias+'" '+e+">"+this.macroName+"</option>")})}break;case"Columns":if("Grid"==e){c=$('<div class="canvas-control-group canvas-clearfix"><label for="'+a+'">'+a+' <a href="#" class="canvas-columns-add">Add Column</a></label><input type="hidden" name="'+a+'" id="'+a+'" value="'+n+'" /></div>');var d=n.split(";"),v=["small","medium","large"];$(d).each(function(a,e){if(""!=e){var n=e.split(":"),t=$('<div class="canvas-control-group canvas-control-group-columns  canvas-clearfix"><select class="canvas-gridColumns-col"></select><select class="canvas-gridColumns-screen"></select><input type="text" class="canvas-gridColumns-config" value="'+n[2]+'"/><a href="#">X</a></div>');for(i=1;i<13;i++)t.find(".canvas-gridColumns-col").append('<option value="'+i+'">'+i+"</option>");$(v).each(function(a,e){t.find(".canvas-gridColumns-screen").append('<option value="'+e+'">'+e+"</option>")}),t.find(".canvas-gridColumns-col option[value="+n[0]+"]").attr("selected","selected"),t.find(".canvas-gridColumns-screen option[value="+n[1]+"]").attr("selected","selected"),c.append(t)}}),c.find(".canvas-columns-add").on("click",function(a){a.preventDefault();var e=["small","medium","large"],n=$(this).closest(".canvas-control-group"),t=$('<div class="canvas-control-group canvas-control-group-columns "><select class="canvas-gridColumns-col"></select><select class="canvas-gridColumns-screen"></select><input type="text" class="canvas-gridColumns-config"/><a href="#">X</a></div>');for(i=1;i<13;i++)t.find(".canvas-gridColumns-col").append('<option value="'+i+'">'+i+"</option>");$(e).each(function(a,e){t.find(".canvas-gridColumns-screen").append('<option value="'+e+'">'+e+"</option>")}),n.append(t)}),$("body").on("click",".canvas-control-group-columns a",function(a){a.preventDefault();var e=$(this).closest(".canvas-control-group-columns");e.remove()})}"Heading"==e&&(c=$('<div class="canvas-control-group canvas-clearfix"><label for="'+a+'">Heading</label><select name="'+a+'" id="'+a+'"><option value="h1" '+("h1"==n?"selected=selcted":"")+'>H1</option><option value="h2" '+("h2"==n?"selected=selcted":"")+'>H2</option><option value="h3" '+("h3"==n?"selected=selcted":"")+'>H3</option><option value="h4" '+("h4"==n?"selected=selcted":"")+" "+(""==n?"selected=selcted":"")+'>H4</option><option value="h5" '+("h5"==n?"selected=selcted":"")+'>H5</option><option value="h6" '+("h6"==n?"selected=selcted":"")+">H6</option></select></div>")),"Button"==e&&(c=s.build("Umbraco.Textbox",a,"Icon",n));break;case"Class":("Grid"==e||"Section"==e||"Heading"==e||"Button"==e)&&(c=s.build("Umbraco.Textbox",a,a,n))}return c},build:function(e,n,t,s){var i=$("");if("Umbraco.TextboxMultiple"==e||"textMultiple"==e)i=$('<div class="canvas-control-group"><label for="'+n+'">'+t+'</label><textarea name="'+n+'" rows="6" id="'+n+'">'+a.helpers.descapeHtml.run(s)+"</textarea></div>");else if("Umbraco.Textbox"==e||"text"==e)i=$('<div class="canvas-control-group"><label for="'+n+'">'+t+'</label><input type="text" name="'+n+'" id="'+n+'" value="'+s+'" /></div>');else if("contentTypeMultiple"==e){var c="Add",o=s.split(",");i=$('<div class="canvas-control-group"><label for="'+n+'">'+t+'</label><div class="canvas-multipleContentPicker-Items"></div><input type="hidden" name="'+n+'" id="'+n+'" value="'+s+'" /></div>');for(var r=0;r<o.length;r++)""!=o[r]&&(a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetContentItem?id="+o[r],success:function(e){a.helpers.loader.stop();var n=$('<div><div class="canvas-multipleContentPicker-Item" data-itemId="'+e.id+'"><a href="#" class="canvas-ContentPicker '+(""!=e.id?"canvas-MultipleContentPicker-remove":"canvas-MultipleContentPicker-add")+'" >'+e.name+"</a></div></div>");i.find(".canvas-multipleContentPicker-Items").append(n.html())},error:function(a,e,n){}}));var l=$('<div><div class="canvas-multipleContentPicker-Item"><a href="#" class="canvas-ContentPicker canvas-MultipleContentPicker-add" >Add</a></div></div>');i.find(".canvas-multipleContentPicker-Items").append(l.html())}else if("Umbraco.ContentPickerAlias"==e||"content"==e){var c="Add";i=$('<div class="canvas-control-group"><label for="'+n+'">'+t+'</label><a href="#" class="canvas-ContentPicker '+(""!=s?"canvas-ContentPicker-remove":"canvas-ContentPicker-add")+'" >'+c+'</a><input type="hidden" name="'+n+'" id="'+n+'" value="'+s+'" /></div>'),""!=s&&(a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetContentItem?id="+s,success:function(e){a.helpers.loader.stop(),i.find("a").text(e.name)},error:function(a,e,n){}}))}else if("Umbraco.TrueFalse"==e||"yesNo"==e){var d="";null!=s&&1==s&&(d='checked="checked"'),i=$('<div class="canvas-control-group canvas-control-checkbox"><label for="'+n+'"><input type="checkbox" name="'+n+'" id="'+n+'" '+d+"/>"+t+"</label></div>")}else"Umbraco.TinyMCEv3"==e?i=$('<div class="canvas-control-group"><label for="'+n+'">'+n+'  <a href="#" class="canvas-content-edit-advanced" style="float:right;">Advanced</a></label><textarea class="canvas-editable" name="'+n+'" id="canvas-editor-simple" rows="7">'+s+"</textarea></div>"):"Umbraco.MediaPicker"==e||"media"==e?(i=$('<div class="canvas-control-group"><label for="'+n+'">'+n+'</label><input type="hidden" name="'+n+'" id="'+n+'" value="'+s+'" /><div class="canvas-image-wrapper" data-Id="'+s+'"><i class="canvas-icon canvas-icon-add"></i></div></div>'),""!=s&&$.ajax({type:"POST",url:a.params.apiUrl+"/GetMediaItem?id="+s,success:function(e){if(i.find(".canvas-image-wrapper p").remove(),"image"==e.type){var n=e.src,t=n.split("."),s=n.replace("."+t[t.length-1],"_thumb."+t[t.length-1]),c="6"==a.params.version()?s:"/umbraco/backoffice/UmbracoApi/Images/GetBigThumbnail?originalImagePath="+e.src,o='<img src="'+c+'" alt="'+e.name+'" title="'+e.name+'"/>';i.find(".canvas-image-wrapper").addClass("canvas-hasImage").removeClass("canvas-hasFile").append(o)}if("file"==e.type){var r='<i class="canvas-icon-document"></i><p>'+e.name+"</p>";i.find(".canvas-image-wrapper").addClass("canvas-hasFile").removeClass("canvas-hasImage").append(r)}if("folder"==e.type){var r='<i class="canvas-icon-folder"></i><p>'+e.name+"</p>";i.find(".canvas-image-wrapper").addClass("canvas-hasFile").removeClass("canvas-hasImage").append(r)}},error:function(a,e,n){}}),i.find(".canvas-image-wrapper").on("click",function(e){e.preventDefault(),a.pickers.mediaPicker.params.$container=$(this).closest(".canvas-control-group"),a.pickers.mediaPicker.init();var n=-1;""!=$(this).attr("data-Id")&&(n=$(this).attr("data-Id")),a.pickers.mediaPicker.loadMedia(n)})):i=$('<div class="canvas-control-group"><label for="'+n+'">'+t+'</label><input type="text" name="'+n+'" id="'+n+'" value="'+s+'" /></div>');return i},renderMacroProperties:function(e,n,t,s){var i=this;a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetMacroProperty?id="+e,success:function(e){a.helpers.loader.stop(),""==t&&$(".canvas-window input[name=Macro]").val("<?UMBRACO_MACRO macroAlias='"+s+"' />"),$(".canvas-macro-properties-wrapper").remove();var c=$('<div class="canvas-macro-properties-wrapper"></div>');$(e.properties).each(function(a,n){var s=$(".canvas-window input[name=Macro]").val(),o="";if(""!=t){var r=new RegExp(e.properties[a].macroPropertyAlias+"=(\"[^<>\"]*\"|'[^<>']*'|w+)","g"),l=r.exec(t);null!=l&&(o=l[1].replace(/"/g,""))}else $(".canvas-window input[name=Macro]").val(s.replace("/>"," "+e.properties[a].macroPropertyAlias+"='' />"));var d=i.build(e.properties[a].editorAlias,e.properties[a].macroPropertyAlias,e.properties[a].macroPropertyName,o);c.append(d)}),c.insertAfter(n)},error:function(a,e,n){}})},tabBuilder:function(a,e,n){var t=this,s=$('<div class="canvas-Tab"><h4>'+a.Name+'</h4><div class="canvas-Tab-Properties"></div></div>');return $(a.PropertyTypes).each(function(a,n){for(var i=n.PropertyEditorAlias,c=n.Alias,o=n.Name,r="",l=0;l<e.length;l++)e[l].Alias==c&&(r=e[l].Value);r||(r="");var d=t.build(i,c,o,r);s.find(".canvas-Tab-Properties").append(d)}),s}}},a.modules={init:function(){this.templates.init(),this.settings.init(),this.advanced()},templates:{init:function(){$("body").on("click",".canvas-template-new",function(e){e.preventDefault();var n=$('<div class="canvas-overlay"><div class="canvas-container"></div></div>').hide(),t=$('<div class="canvas-editor-wrapper"><label for="canvas-code-name">Name</label><input type="text" name="canvas-code-name" id="canvas-code-name" /> <textarea name="canvas-codeEditor" id="canvas-codeEditor" style="width:100%; height:500px;"></textarea><div class="canvas-editor-controls"><button type="button" class="canvas-btn canvas-btn-primary">Save</button><button type="button" class="canvas-btn canvas-btn-secondary">Cancel</button></div></div>');n.find(".canvas-container").append(t),$("body").append(n.fadeIn());var s=CodeMirror.fromTextArea(document.getElementById("canvas-codeEditor"),a.modules.codeMirror.config);a.modules.codeMirror.setMode(s,"xml"),a.modules.codeMirror.setMode(s,"javascript"),a.modules.codeMirror.setMode(s,"css"),a.modules.codeMirror.setMode(s,"htmlmixed"),s.getDoc().setValue("@inherits Umbraco.Web.Mvc.UmbracoViewPage<dynamic>"),s.setSize("100%",500),t.on("click",".canvas-btn-primary",function(e){e.preventDefault();var n=$(this);$.ajax({type:"POST",url:a.params.apiUrl+"/CreateTemplate",data:{content:s.getValue(),name:$("#canvas-code-name").val(),controlType:$(".canvas-window input[name=controlType]").val()},success:function(a){n.removeAttr("disabled"),a.success?($(".canvas-control-group #Template").html('<option value="">Select Template</option>'),$(a.templates).each(function(a){var e="";$("#canvas-code-name").val()==this.name&&(e='selected="selected"'),$(".canvas-control-group #Template").append('<option value="'+this.path+'" '+e+">"+this.name+"</option>")}),$(".canvas-overlay").fadeOut(function(){$(this).remove()})):alert(a.message)},error:function(a,e,t){n.removeAttr("disabled")}})}),t.on("click",".canvas-btn-secondary",function(a){a.preventDefault(),$(".canvas-overlay").fadeOut(function(){$(this).remove()})})}),$("body").on("click",".canvas-macro-editTemplate",function(e){e.preventDefault();var n=$(this).closest(".canvas-control-group"),t=n.find("#select-Macro");if(""!=t.val()){var s=$('<div class="canvas-overlay"><div class="canvas-container"></div></div>').hide(),i=$('<div class="canvas-editor-wrapper"><textarea name="canvas-codeEditor" id="canvas-codeEditor" style="width:100%; height:500px;"></textarea><div class="canvas-editor-controls"><button type="button" class="canvas-btn canvas-btn-primary">Save</button><button type="button" class="canvas-btn canvas-btn-secondary">Cancel</button></div></div>');s.find(".canvas-container").append(i),$("body").append(s.fadeIn());var c=CodeMirror.fromTextArea(document.getElementById("canvas-codeEditor"),a.modules.codeMirror.config);a.modules.codeMirror.setMode(c,"xml"),a.modules.codeMirror.setMode(c,"javascript"),a.modules.codeMirror.setMode(c,"css"),a.modules.codeMirror.setMode(c,"htmlmixed"),c.getDoc().setValue("@inherits Umbraco.Web.Mvc.UmbracoViewPage<dynamic>"),$.ajax({type:"POST",url:a.params.apiUrl+"/GetMacroTemplateValue",data:{id:t.val()},success:function(a){c.getDoc().setValue(a.content),c.setSize("100%",500)}}),i.on("click",".canvas-btn-primary",function(e){e.preventDefault();var n=$(this);n.attr("disabled","disabled"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/SaveMacroTemplate",data:{content:c.getValue(),id:t.val()},success:function(e){a.helpers.loader.stop(),n.removeAttr("disabled"),e.success?a.params.getIframeWindow().location.reload():alert(e.message)},error:function(a,e,t){n.removeAttr("disabled")}})}),i.on("click",".canvas-btn-secondary",function(a){a.preventDefault(),$(".canvas-overlay").fadeOut(function(){$(this).remove()})})}else alert("No template selected")}),$("body").on("click",".canvas-template-edit",function(e){e.preventDefault();var n=$(this).closest(".canvas-control-group"),t=n.find("#Template");if(""!=n.find("#Template").val()){var s=$('<div class="canvas-overlay"><div class="canvas-container"></div></div>').hide(),i=$('<div class="canvas-editor-wrapper"><label for="canvas-code-name">Name</label><input type="text" name="canvas-code-name" id="canvas-code-name"  value="'+t.find("option:selected").text()+'"  /> <textarea name="canvas-codeEditor" id="canvas-codeEditor" style="width:100%; height:500px;"></textarea><div class="canvas-editor-controls"><button type="button" class="canvas-btn canvas-btn-primary">Save</button><button type="button" class="canvas-btn canvas-btn-secondary">Cancel</button><button type="button" class="canvas-btn canvas-btn-danger canvas-right">Delete</button></div></div>');s.find(".canvas-container").append(i),$("body").append(s.fadeIn());var c=CodeMirror.fromTextArea(document.getElementById("canvas-codeEditor"),a.modules.codeMirror.config);a.modules.codeMirror.setMode(c,"xml"),a.modules.codeMirror.setMode(c,"javascript"),a.modules.codeMirror.setMode(c,"css"),a.modules.codeMirror.setMode(c,"htmlmixed"),c.getDoc().setValue("@inherits Umbraco.Web.Mvc.UmbracoViewPage<dynamic>"),$.ajax({type:"POST",url:a.params.apiUrl+"/GetTemplateValue",data:{path:t.val()},success:function(a){c.getDoc().setValue(a.content),c.setSize("100%",500)}}),i.on("click",".canvas-btn-primary",function(e){e.preventDefault();var n=$(this);n.attr("disabled","disabled"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/SaveTemplate",data:{content:c.getValue(),name:$("#canvas-code-name").val(),controlType:$(".canvas-window input[name=controlType]").val()},success:function(e){a.helpers.loader.stop(),n.removeAttr("disabled"),e.success?(t.html('<option value="">Select emplate</option>'),$(e.templates).each(function(a){var e="";$("#canvas-code-name").val()==this.name&&(e='selected="selected"'),t.append('<option value="'+this.path+'" '+e+">"+this.name+"</option>")}),$(".canvas-overlay").fadeOut(function(){$(this).remove()})):alert(e.message)},error:function(a,e,t){n.removeAttr("disabled")}})}),i.on("click",".canvas-btn-secondary",function(a){a.preventDefault(),$(".canvas-overlay").fadeOut(function(){$(this).remove()})}),i.on("click",".canvas-btn-danger",function(e){e.preventDefault();var n=$(this);n.attr("disabled","disabled"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/DeleteTemplate",data:{path:t.val(),controlType:$(".canvas-window input[name=controlType]").val()},success:function(e){n.removeAttr("disabled"),a.helpers.loader.stop(),e.success?(t.html('<option value="">Select Template</option>'),$(e.templates).each(function(a){t.append('<option value="'+this.path+'">'+this.name+"</option>")}),$(".canvas-overlay").fadeOut(function(){$(this).remove()})):alert("Server error")},error:function(e,t,s){n.removeAttr("disabled"),a.helpers.loader.stop()}})})}else alert("No template selected")})}},codeMirror:{config:{mode:"htmlmixed",lineNumbers:!0,lineWrapping:!0,tabSize:4,matchBrackets:!0,styleActiveLine:!0},setMode:function(a,e){if(void 0!==e){var n="/Umbraco/lib/codemirror/mode/"+e+"/"+e+".js";$.getScript(n,function(n,t){t?a.setOption("mode",e):a.setOption("mode","clike")})}else a.setOption("mode","clike")}},settings:{init:function(){$("body").on("click",".canvas-item-settings",function(e){e.preventDefault(),$window=$(".canvas-window"),$(".canvas-menu").removeClass("canvas-open"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetSettings?pageId="+a.params.pageId(),success:function(e){a.helpers.loader.stop(),$window.html("");var n="",t=$('<form method="post" action="'+a.params.apiUrl+'/SavePage" class="canvas-page-save"><input type="hidden" name="pageId" value="'+a.params.pageId()+'" /></form>');$(e.tabs).each(function(s,i){n=a.control.propertiesBuilder.tabBuilder(i,e.properties,t),t.append(n)}),t.append('<button type="submit" data-type="save">Save</button>'),$window.append('<a href="#" class="canvas-window-close">Close window</a>').append(t).addClass("canvas-open");var s=tinymce.get("canvas-editor-simple");null!=s&&s.remove(),tinymce.init(a.params.tinyMceConfig),t.on("click",".canvas-Tab h4",function(a){$(this).parent().find(".canvas-Tab-Properties").toggle()}),t.on("submit",function(e){e.preventDefault(),a.helpers.loader.start(),t.find("button[type=submit]").attr("disabled","disabled").text("..."),
$.ajax({type:"POST",url:t.attr("action"),data:t.serialize(),success:function(e){a.params.getIframeWindow().location.reload(),t.find("button[type=submit]").removeAttr("disabled").text("Save")},error:function(e,n,t){a.helpers.loader.stop()}})})}})})}},advanced:function(){$("body").on("click",".canvas-content-edit-advanced",function(e){e.preventDefault();var n=$('<div class="canvas-overlay"><div class="canvas-container"></div></div>').hide(),t=$('<div class="canvas-editor-wrapper"><textarea name="canvas-advanced-content" id="canvas-advanced-content" style="width:100%; height:500px;"></textarea><div class="canvas-editor-controls"><button type="button" class="canvas-btn canvas-btn-primary">Save</button><button type="button" class="canvas-btn canvas-btn-secondary">Cancel</button></div></div>');n.find(".canvas-container").append(t),$("body").append(n.fadeIn()),t.on("click",".canvas-btn-primary",function(a){a.preventDefault();var e=tinymce.get("canvas-advanced-content").getContent();tinymce.get("canvas-editor-simple").setContent(e),$(".canvas-overlay").fadeOut(function(){$(this).remove()})}),n.find(".container").append(t),$("body").append(n.fadeIn());var s=a.params.tinyMceConfigAdv;s.setup=function(e){e.addButton("umbmediapicker",{icon:"custom icon-picture",tooltip:"Media Picker",onclick:function(){var n,t=e.selection.getNode();if("IMG"===t.nodeName){var s=$(t);n={name:s.attr("alt"),url:s.attr("src"),id:s.attr("rel")}}var i=e.selection.getContent();a.pickers.mediaPicker.init(e,i);var c=-1;a.pickers.mediaPicker.loadMedia(c)}}),e.addButton("umbcontentpicker",{icon:"custom icon-document",tooltip:"Content Picker",onclick:function(){e.selection.getContent();a.pickers.contentPicker.open()}})};var i=tinymce.get("canvas-advanced-content");null!=i&&i.remove(),tinymce.init(s);var c=tinymce.get("canvas-editor-simple").getContent();tinymce.get("canvas-advanced-content").setContent(c),t.on("click",".canvas-btn-secondary",function(a){a.preventDefault(),$(".canvas-overlay").fadeOut(function(){$(this).remove()})})})}},a.pickers={init:function(){this.contentPicker.init(),this.multipleContentPicker.init()},contentPicker:{params:{$container:""},init:function(e,n){var t=this;$("body").on("click",".canvas-ContentPicker-add",function(a){a.preventDefault(),t.params.$container=$(this).closest(".canvas-control-group"),t.open()}),$("body").on("click",".canvas-ContentPicker-remove",function(a){a.preventDefault();var e=$(this).closest(".canvas-control-group");e.find("input").val(""),e.find("a").text("Add").removeClass("canvas-ContentPicker-remove").addClass("canvas-ContentPicker-add")}),$("body").on("click",".canvas-contentpicker .canvas-plus",function(){var e=$(this).next().attr("data-contentId"),n=$(this).parent();n.find(" > ul").length>0?n.toggleClass("canvas-open"):(n.addClass("canvas-open"),$.ajax({type:"POST",url:a.params.apiUrl+"/GetContent",data:{pageId:e},success:function(a){var e=$("<ul></ul>");$(a).each(function(a,n){e.append('<li class="'+(n.hasChildren?"canvas-hasChildren":"canvas-hasNoChildren")+'">'+(n.hasChildren?'<div class="canvas-plus"></div>':"")+'<a href="#" data-href='+n.url+" data-contentId="+n.id+">"+n.name+"</a></li>")}),n.append(e)}}))}),$("body").on("click",".canvas-contentpicker .canvas-Content-Tree a",function(a){if(a.preventDefault(),"undefined"!=typeof e){var s=$(this).text(),i=$(this).attr("data-href").replace(/^.*\/\/[^\/]+/,"");""!=n?e.selection.setContent('<a href="'+i+'">'+n+"</strong>"):e.insertContent(e.dom.createHTML("a",{href:i},s))}else t.params.$container.find("input").val($(this).attr("data-contentId")),t.params.$container.find("a").text($(this).text()).removeClass("canvas-ContentPicker-add").addClass("canvas-ContentPicker-remove");$(".canvas-overlap").fadeOut(function(){$(this).remove()})})},open:function(){$(".canvas-overlap").remove();var e=$('<div class="canvas-overlap canvas-contentpicker"><div class="canvas-content-container"></div><!--div class="canvas-overlap-footer"><a href="#">Cancel</a></div--></div>').hide();$("body").append(e.fadeIn()),$(".canvas-overlap").on("click",".canvas-overlap-footer a",function(a){a.preventDefault(),$(".canvas-overlap").fadeOut(function(){$(this).remove()})}),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetContent",data:{pageId:0},success:function(n){a.helpers.loader.stop();var t=$('<ul class="canvas-Content-Tree"></ul>');$(n).each(function(a,e){t.append('<li class="'+(e.hasChildren?"canvas-hasChildren":"canvas-hasNoChildren")+'">'+(e.hasChildren?'<div class="canvas-plus"></div>':"")+'<a href="#" data-href='+e.url+" data-contentId="+e.id+">"+e.name+"</a></li>")}),e.find(".canvas-content-container").append(t),$("body").append(e.fadeIn()),a.helpers.resizeWindow($(".canvas-overlap")),$(window).on("resize",function(){a.helpers.resizeWindow($(".canvas-overlap"))})}})}},multipleContentPicker:{params:{$container:""},init:function(){var e=this;$("body").on("click",".canvas-MultipleContentPicker-add",function(a){a.preventDefault(),e.params.$container=$(this).closest(".canvas-control-group"),e.params.$item=$(this).closest(".canvas-multipleContentPicker-Item"),e.open()}),$("body").on("click",".canvas-MultipleContentPicker-remove",function(a){a.preventDefault();var e=$(this).closest(".canvas-control-group"),n=$(this).closest(".canvas-multipleContentPicker-Item"),t=n.attr("data-itemId");e.find("input").val(e.find("input").val().replace(","+t,"").replace(t,"")),n.remove()}),$("body").on("click",".canvas-multiplecontentpicker-menu .canvas-plus",function(){var e=$(this).next().attr("data-contentId"),n=$(this).parent();n.find(" > ul").length>0?n.toggleClass("canvas-open"):(n.addClass("canvas-open"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetContent",data:{pageId:e},success:function(e){a.helpers.loader.stop();var t=$("<ul></ul>");$(e).each(function(a,e){t.append('<li class="'+(e.hasChildren?"canvas-hasChildren":"canvas-hasNoChildren")+'">'+(e.hasChildren?'<div class="canvas-plus"></div>':"")+'<a href="#" data-href='+e.href+" data-contentId="+e.id+">"+e.name+"</a></li>")}),n.append(t)}}))}),$("body").on("click",".canvas-multiplecontentpicker-menu a",function(a){a.preventDefault();var n=",";""===e.params.$container.find("input").val()&&(n=""),e.params.$container.find("input").val(e.params.$container.find("input").val()+n+$(this).attr("data-contentId")),e.params.$item.find("a").text($(this).text()).removeClass("canvas-MultipleContentPicker-add").addClass("canvas-MultipleContentPicker-remove"),e.params.$container.find(".canvas-multipleContentPicker-Items").append('<div class="canvas-multipleContentPicker-Item"><a href="#" class="canvas-ContentPicker canvas-MultipleContentPicker-add">Add</a></div>'),$(".canvas-overlap").fadeOut(function(){$(this).remove()})})},open:function(){$(".canvas-overlap").remove();var e=$('<div class="canvas-overlap canvas-multiplecontentpicker-menu"><div class="canvas-content-menu-container"></div><div class="canvas-overlap-footer"><a href="#">Cancel</a></div></div>').hide();$("body").append(e.fadeIn()),$(".canvas-overlap").on("click",".canvas-overlap-footer a",function(a){a.preventDefault(),$(".canvas-overlap").fadeOut(function(){$(this).remove()})}),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/GetContent",data:{pageId:0},success:function(n){a.helpers.loader.stop();var t=$('<ul class="canvas-Content-Tree"></ul>');$(n).each(function(a,e){t.append('<li class="'+(e.hasChildren?"canvas-hasChildren":"canvas-hasNoChildren")+'">'+(e.hasChildren?'<div class="canvas-plus"></div>':"")+'<a href="#" data-contentId='+e.id+">"+e.name+"</a></li>")}),e.find(".canvas-content-menu-container").append(t),$("body").append(e.fadeIn())}})}},mediaPicker:{params:{$container:""},init:function(e,n){var t=this;$(".canvas-overlap").remove();var s=$('<div class="canvas-overlap"><div class="canvas-media-menu-header"><a href="#" class="canvas-window-close">Close window</a><ul class="canvas-media-breadcrumb"></ul></div><div class="canvas-media-menu-container"></div><div class="canvas-overlap-footer"><a href="#">Cancel</a></div></div>').hide();$("body").append(s.fadeIn()),$(".canvas-overlap").on("click",".canvas-media-folder a",function(a){var e=$(this);a.preventDefault();var n=e.parent().find("i"),s="<p>"+e.parent().text()+"</p>";$(".canvas-image-wrapper i,.canvas-image-wrapper img,.canvas-image-wrapper p").remove(),t.params.$container.find(".canvas-image-wrapper").append(n).append(s).addClass("canvas-hasFile").attr("data-Id",e.parent().attr("data-Id")).removeClass("canvas-hasImage"),t.params.$container.find("input[type=hidden]").val(e.parent().attr("data-Id")),$(".canvas-overlap").fadeOut(function(){$(this).remove()})}),$(".canvas-overlap").on("click",".canvas-media-folder,.canvas-media-breadcrumb a",function(a){a.preventDefault();var e=$(this);$(".canvas-media-menu-container").fadeOut(function(){$(".canvas-media-menu-container").html(""),t.loadMedia(e.attr("data-Id"))})}),$(".canvas-overlap").on("click",".canvas-overlap-footer a",function(a){a.preventDefault(),$(".canvas-overlap").fadeOut(function(){$(this).remove()})}),$(".canvas-overlap").on("click",".canvas-media-image",function(){var n=$(this),s=n.find("img");if($(".canvas-content-overlay").length>0){var i={alt:"",src:s.attr("data-src"),rel:"",id:"__mcenew"};e.insertContent('<div class="img-wrapper">'+e.dom.createHTML("img",i)+"</div>"),window.setTimeout(function(){var n=e.dom.get("__mcenew"),t=e.dom.getSize(n),s=a.modules.media.scaleToMaxSize(800,t.w,t.h);e.dom.setAttrib(n,"id",null);var c=i.src+"?width="+s.width+"&height="+s.height;e.dom.setAttrib(n,"src",c),e.dom.setAttrib(n,"data-mce-src",c)},500)}else t.params.$container.find(".canvas-image-wrapper i,.canvas-image-wrapper img,.canvas-image-wrapper p").remove(),t.params.$container.find(".canvas-image-wrapper").append(s).addClass("canvas-hasImage").attr("data-Id",n.attr("data-Id")).removeClass("canvas-hasFile"),t.params.$container.find("input[type=hidden]").val(n.attr("data-Id"));$(".canvas-overlap").fadeOut(function(){$(this).remove()})}),$(".canvas-overlap").on("click",".canvas-media-file",function(){var a=$(this),s=a.find("i"),i="<p>"+a.text()+"</p>";if($(".canvas-image-wrapper i,.canvas-image-wrapper img,.canvas-image-wrapper p").remove(),$(".canvas-content-overlay").length>0){var c=a.attr("data-src");""!=n?e.selection.setContent('<a href="'+c+'">'+n+"</strong>"):e.insertContent(e.dom.createHTML("a",{href:c},a.text()))}else t.params.$container.find(".canvas-image-wrapper").append(s).append(i).addClass("canvas-hasFile").attr("data-Id",a.attr("data-Id")).removeClass("canvas-hasImage"),t.params.$container.find("input[type=hidden]").val(a.attr("data-Id"));$(".canvas-overlap").fadeOut(function(){$(this).remove()})})},loadMedia:function(e){$.ajax({type:"POST",url:a.params.apiUrl+"/GetMedia?id="+e,success:function(e){$(".canvas-media-breadcrumb").html('<li><a href="#" data-Id="-1">Media</a></li>'),$(e.history).each(function(a,e){$(".canvas-media-breadcrumb").append('<li><a href="#" data-Id="'+e.id+'">'+e.name+"</a></li>")}),$(e.items).each(function(e,n){var t="";if("1031"==n.contentType&&(t='<div class="canvas-media-folder canvas-media-item" data-Id="'+n.id+'"><a href="#" class="canvas-icon-add"></a><i class="canvas-icon-folder"></i> '+n.text+"</div>"),"1032"==n.contentType){var s=n.src,i=s.split("."),c=s.replace("."+i[i.length-1],"_thumb."+i[i.length-1]),o="6"==a.params.version()?c:"/umbraco/backoffice/UmbracoApi/Images/GetBigThumbnail?originalImagePath="+n.src;t='<div class="canvas-media-image canvas-media-item" data-Id="'+n.id+'"><img src="'+o+'" alt="'+n.text+'" title="'+n.text+'" data-src="'+n.src+'"/></div>'}"1033"==n.contentType&&(t='<div class="canvas-media-file canvas-media-item" data-Id="'+n.id+'" data-src="'+n.src+'"><i class="canvas-icon-document"></i> '+n.text+"</div>"),$(".canvas-media-menu-container").append(t).fadeIn()})},error:function(a,e,n){}})},scaleToMaxSize:function(a,e,n){var t={width:e,height:n},s=a,i=a,c=0;return e>s&&(c=s/e,t.width=s,t.height=n*c,n*=c,e*=c),n>i&&(c=i/n,t.height=i,t.width=e*c,e*=c),t},canvasResizeImage:function(a){var e=this;a.on("mouseup",function(n){var t=a.selection.getNode();"IMG"==t.tagName&&-1!=t.src.indexOf("width")&&setTimeout(e.fixSize(t,a),100)})},fixSize:function(a,e){newWidth=a.width,newHeight=a.height,newUrl=a.src.replace(/width=[0-9]+/,"width="+newWidth),newUrl=newUrl.replace(/height=[0-9]+/,"height="+newHeight),e.dom.setAttrib(a,"src",newUrl)}}},a.helpers={init:function(){this.isPagePublished(),$("body").on("click",".canvas-window-close",function(a){a.preventDefault(),$window=$(this).closest(".canvas-window"),$window.removeClass("canvas-open"),$(this).closest(".canvas-overlap").hide(),setTimeout(function(){$window.html("")},300)})},isPagePublished:function(){var e=this;$.ajax({type:"POST",url:a.params.apiUrl+"/IsPagePublished?pageId="+a.params.pageId(),success:function(a){0==a.isPublished&&e.RenderPublish()},error:function(a,e,n){}})},RenderPublish:function(){$(".canvas-item-publish").length<=0&&($(".canvas-bar .canvas-right").append('<a href="#" class="canvas-item canvas-border-left canvas-item-cancel canvasicon-cross2"></a><a href="#" class="canvas-item canvas-border-left canvas-item-publish canvasicon-floppy-disk"></a>'),$("body").on("click",".canvas-item-publish",function(e){e.preventDefault();var n=$(this);n.attr("disabled","disabled"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/PublishPage?pageId="+a.params.pageId(),success:function(e){n.removeAttr("disabled"),a.helpers.loader.stop(),$(".canvas-item-cancel, .canvas-item-publish").fadeOut(function(){$(this).remove()})}})}),$("body").on("click",".canvas-item-cancel",function(e){e.preventDefault();var n=$(this);n.attr("disabled","disabled"),a.helpers.loader.start(),$.ajax({type:"POST",url:a.params.apiUrl+"/Cancel?pageId="+a.params.pageId(),success:function(e){n.removeAttr("disabled"),a.params.getIframeWindow().location.reload()},error:function(a,e,n){}})}))},loader:{start:function(){$(".canvas-progress-loader").length<=0&&$("body").append('<div class="canvas-progress-loader"></div>')},stop:function(){$(".canvas-progress-loader").fadeOut(function(){$(this).remove()})}},getQueryString:function(a){if("parent"==a)var e=window.parent.location.search.replace("?","").split("&");else var e=window.location.search.replace("?","").split("&");var n={};if(""!=e)for(i=0;i<e.length;i++)n[e[i].split("=")[0]]=e[i].split("=")[1];return n},resizeWindow:function(a){var e=$(window).height();a.css("height",e-60)},escapeHtml:{map:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","\n":"&lt;br&gt;"},run:function(a){var e=this;return String(a).replace(/[&<>"'\/]|[\n]/g,function(a){return e.map[a]})}},descapeHtml:{map:{"&lt;br&gt;":"\n"},run:function(a){var e=this;return String(a).replace(/&lt;br&gt;/g,function(a){return e.map[a]})}}},a.initialize=function(){a.bar.init(),a.pickers.init(),a.modules.init(),a.helpers.init(),$("body").append('<div class="canvas-window"></div>'),CanvasApp=a}()};